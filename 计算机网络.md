## OSI七层模型

1.物理层：传输电信号和原始比特流(二进制数据)
  - 常见应用：网线，集线器，网卡
  - 常见协议：IEEE，InternetWork

2.数据链路层：物理寻址，透明传输，封装成帧，差错检测，该层只能建立局域网之间的数据传输
  - 常见应用：网桥，交换机
  - 常见协议：PPP，ARP，RARP

3.网络层：通过路由建立跨网关之间的链接，将mac报文封装成ip数据报
  - 常见应用：路由器
  - 常见协议：ipv4,ipv6
  - 路由协议：r2p

4.传输层：对数据进行分组，提供端到端的可靠链接
  - 常见应用：网关
  - 常见协议：tcp,upd

5.会话层：管理传输层建立的端到端之间的会话和链接
  - 常见应用：网关
  - 常见协议：ssl，tls(安全协议)，RPC远程调用协议

6.表示层：对其上下层送来的数据进行解密，压缩，解码等，保证送到应用层的数据格式统一

7.应用层：对os和应用提供网络访问服务
  - 常见应用：网关
  - 常见协议：http，dns，ftp，dhcp，smtp，pop3

## TCP/IP四层模型

1.数据接口层：对应osi中的1,2层，提供tcp/ip协议和物理设备之间的交互接口
  - 常见协议：ARP，RARP

2.网络层：对应OSI中的网络层

3.传输层：对应OSI中的传输层

4.应用层：对应OSI的5,6,7层

## tcp和udp的区别

1.tcp首部20字节，udp首部8字节

2.tcp使用可靠全双工信道提供可靠传输服务，预先进行tcp三次握手，upd使用不可靠信道，目标是尽最大努力交付

3.tcp面向字节流，udp面向报文，所以tcp可能粘包

4.udp无拥塞处理机制，网络中出现阻塞时不会降低发送端的发送效率

5.tcp只支持点对点，udp支持点对点，一对多，多对多

## tcp三次握手

1.客户端和服务器创建TCB进程控制块，服务器进入监听状态等待客户端连接请求

2.客户端发出请求，seq=x(序列号)，syn置为1,tcp规定syc=1的报文不能携带数据，消耗一个序列号，一般用于建立连接和请求

3.服务器若同意连接则发出确认报文，seq=y，ack置为1且ack号=x+1

4.客户端收到服务器发来的确认报文，比较ack号，若ack号正确，则发送ack号=y+1并将序列号seq=x+1返回给服务器，若服务器确认ack号正确，则客户端服务器进入已建立链接状态，之后就可以开始通信了

## 为什么要三次握手

1.如果是两次握手，对于客户端的数据包，可通过seq进行确认

2.但服务器返回客户端的数据包无法通过seq进行确认，因为没有客户端返回的确认信息了

3.三次握手本质上合并了四次握手中的第二次和第三次

4.所以理由如下：
  - 保证双方传输的可靠性
  - 提高传输效率

## 四次挥手

1.客户端发送释放链接报文，fin=1,seq=x,之后进入等待状态1

2.服务器发送确认报文，ack置为1并ack号=x+1,seq=y,进入从close-wait状态，并通知应用进入半管理状态

3.客户端收到确认报文，核对ack，之后进入停止等待状态2

4.服务器将剩余数据发送完毕，假定seq此时为y+n,同时向客户端发送fin=1,seq=y+n，之后进入最后确认状态

5.客户端收到释放链接报文后，确认ack=y+n+1,seq=x+1,进入时间等待状态，等待两个最大报文寿命(2MSL)后关闭链接，销毁对应的tcb块，进入closed状态

6.服务器收到客户端确认报文，关闭链接，销毁tcb，进入closed状态

## 为什么要四次挥手

1.因为tcp是全双工通道

2.对于两台主机，每次收到的fin报文只保证发送方不会再发来数据，但不保证自己再次发送数据，即只关闭了单向通道

3.所以需要四次握手关闭双向通道，本质上其实是两个两次握手

## 为什么序列号不能从0开始，为什么序列号是随机开始的

1.防止tcp报文伪造

2.如果都从0开始，那么不同数据包只要长度一样，seq和ack就一样了，可能会产生粘包，导致不属于同一个完整数据包的两段数据包被错判为同一个数据包

## tcp的数据传输控制机制

1.超时重传：使用RTO重传定时器，根据多次往返时间(RTT)的平均值确定RTO，如果出现超时(即未收到ack)，则认为报文丢失，重传(linux15次，windows5次)

2.流量控制：使用tcp滑动窗口规定每次传输的数据范围，只有收到确认ack后才移动窗口，并且接收端可以根据自己的情况设置窗口大小，从而进行流量控制

3.拥塞控制：
  - 1.慢开始：通过提前嗅探网络拥塞状况控制发送的数据量，从小到达依次慢慢增加拥塞窗口(拥塞窗口可以理解为滑动窗口)，每次增加双倍，初始大小为1
  - 2.拥塞避免：执行慢开始出现拥塞时，将拥塞阈值变为一半，并将拥塞窗口置为1,之后每次增加拥塞窗口+1而不是两倍
  - 3.快重传：发送方连续收到三个相同的ack确认后，则认为接收方出现了丢包(接收方发现丢包的话就向发送方连续发三个ack确认)，则停下其他报文的发送，优先将丢失的数据包重传后，再次恢复其他数据包的发送
  - 4.快恢复：发送方连续收到n(n>=3)个相同的ack确认后，将拥塞阈值减半，将拥塞窗口置为阈值+n,直到收到了新的ack后，再将拥塞窗口重置为阈值大小


